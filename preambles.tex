\usepackage{etoolbox}
\usepackage{url}
\usepackage{amsmath}
\usepackage{siunitx}
\usepackage{tikz}
\usepackage{mathtools}
\usepackage{float}
\usepackage{tabularx}
\usepackage{paralist}
\usepackage{pgfplots}
\pgfplotsset{compat=1.7}


% This package allows the use of conditions, making the template more dynamic.
\usepackage{ifthen}

% This is for overwriting the commands.
\newcommand{\declarecommand}[1]{\providecommand{#1}{}\renewcommand{#1}}

% This package is to create dummy texts. You may delete it after there is no 
% dummy text anymore.
\usepackage{blindtext}

% This package is for placing textboxes at the desired positions.
\usepackage[absolute,overlay]{textpos}

% This package for the hyperlinks.
\usepackage[hidelinks,unicode]{hyperref}

% This part is for positioning the page numberings.
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\footskip=0.5cm
\fancyhfoffset[RO,L]{0.5cm}
\rfoot{\thepage}
\makeatletter
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
	\thispagestyle{fancy}
	\global\@topnum\z@
	\@afterindentfalse
	\secdef\@chapter\@schapter}
\makeatother

% This package is to set the paper type and margins.
\usepackage{geometry}
\geometry{
	a4paper,
	left   = 3.5cm,
	top    = 2.5cm,
	right  = 2.5cm,
	bottom = 2.5cm
}

% These packages are to set the font as Times New Roman.
\usepackage{newtxtext}
\usepackage{newtxmath}
\usepackage{titlesec}

% To set the chapter headings
\titleformat{\chapter}
    [display]
    {\centering\normalfont\fontsize{16}{24}\selectfont\bfseries}
    {CHAPTER \thechapter}
    {0.72cm}{\MakeUppercase}
\titlespacing*{\chapter}{0pt}{-1.2cm}{1cm}

% To set the section headings
\titleformat{\section}
    [hang]
    {\normalfont\fontsize{14}{14}\selectfont\bfseries}
    {\thesection.}
    {0.25em}{}
\titlespacing*{\section}{0pt}{1.0cm}{0.8cm}

% To set the subsection headings
\titleformat{\subsection}
    [hang]
    {\normalfont\fontsize{14}{14}\selectfont\bfseries}
    {\thesubsection.}
    {0.25em}{}

% Set the default font size as 12
\fontsize{12}{12}

% It is for the spacing.
\usepackage{setspace}
\setstretch{1.5}

% Set spacings
\newcommand{\OneAndHalfSpacing}{\vspace{0.15cm}}
\newcommand{\DoubleOneAndHalfSpacing}{\vspace{1.30cm}}

% Set indentations
\setlength{\parindent}{1.27cm}
\usepackage{indentfirst}

% Set bibliography

\usepackage[
    style=chem-acs,
    articletitle=true,
    backend=biber,
    doi=false,
    sorting=none,
    maxnames=999,
    minnames=999
]{biblatex}

\DeclareFieldFormat{labelnumberwidth}{#1.}
\setlength{\labelnumberwidth}{1.0em}

\addbibresource{references.bib}
\declarecommand{\cite}[1]{\autocite{#1}}
\DeclareCiteCommand{\citenum}{}{\printfield{labelnumber}}{}{}


% Set appendices
\RequirePackage[toc,title]{appendix}
\AtBeginDocument{\renewcommand\appendixname{APPENDIX}}
\AtBeginDocument{\renewcommand{\appendixtocname}{APPENDICES}}
\newenvironment{thesisappendices}{
	\addtocontents{toc}{\protect\renewcommand{\protect\cftchappresnum}{\appendixname\space}}
	\addtocontents{toc}{\protect\vskip20pt}
	\addtocontents{toc}{\protect\setlength{\cftbeforechapskip}{1pt}}
	\begin{appendices}
	\titleformat{\chapter}
	    [display]
    {\centering\normalfont\fontsize{16}{24}\selectfont\bfseries}
    {APPENDIX \thechapter}
    {0.72cm}{\MakeUppercase}
}{
	\end{appendices}
}

% Set text block center
\newcommand{\TextBlockCenter}{\dimexpr\paperwidth/2-\textwidth/2}

% Set the table of contents
\AtBeginDocument{\renewcommand\chaptername{CHAPTER}}
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}
\usepackage[nottoc]{tocbibind}
\RequirePackage[titles]{tocloft}
\renewcommand{\contentsname}{TABLE OF CONTENTS}
\renewcommand{\listtablename}{LIST OF TABLES}
\renewcommand{\listfigurename}{LIST OF FIGURES}
\renewcommand{\cftpartleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftdotsep}{1}
\renewcommand{\cftchapfont}{\normalfont}
\renewcommand{\cftchappagefont}{} 
\renewcommand{\cftpartpagefont}{}
\renewcommand{\cftsecaftersnum}{.}
\setlength{\cftbeforechapskip}{20pt}
\setlength{\cftbeforetoctitleskip}{0pt}
\setlength{\cftbeforeloftitleskip}{0pt}
\setlength{\cftbeforelottitleskip}{0pt}
\renewcommand\cftchappresnum{\chaptername~}
\renewcommand\cftchapaftersnum{. \ \ }
\renewcommand\cftsubsecaftersnum{.}
\newlength{\mytoclength}
\settowidth{\mytoclength}{\cftchappresnum\cftchapaftersnum}
\addtolength\cftchapnumwidth{\mytoclength}
\setlength{\cftsecindent}{4.8em}
\setlength{\cftsubsecindent}{5.55em}
\setlength{\cftsubsubsecindent}{6.3em}
\setlength{\cftparaindent}{7.05em}
\setlength{\cftsubparaindent}{7.8em}

% Set lists
\makeatletter
\newlength{\latexpnumwidth}
\setlength{\latexpnumwidth}{\@pnumwidth}
\renewcommand{\cfttabpresnum}{\tablename~}
\newlength{\mylotlength}
\settowidth{\mylotlength}{\cfttabpresnum\cfttabaftersnum}
\addtolength\cfttabnumwidth{\mylotlength}
\let\origcftdot\cftdot
\addtocontents{toc}{\protect\vspace{-0.85cm}}
\setlength{\cfttabindent}{0cm}
\addtocontents{lot}{\protect\cftsetpnumwidth{25pt}}
\addtocontents{lot}{\protect\renewcommand{\protect\cftdot}{}}

\phantomsection
\addtocontents{lot}{
  \protect\contentsline{table}{
    \hspace{-0.1cm}\begin{minipage}[t]{\textwidth}
      \centering
      \textbf{\underline{\tablename \phantom{g}}}
      \hfill
      \textbf{\underline{Page}}
    \end{minipage}
}{}{}} 

\phantomsection\addtocontents{lot}{\vspace{-1.1cm}}
\addtocontents{lot}{\protect\renewcommand{\protect\cftdot}{\origcftdot}}

\renewcommand{\cftfigpresnum}{\figurename~}
\newlength{\myloflength}
\settowidth{\myloflength}{\cftfigpresnum\cftfigaftersnum}
\addtolength\cftfignumwidth{\myloflength}
\setlength{\cftfigindent}{0cm}
\let\origcftdot\cftdot
\addtocontents{lof}{\protect\cftsetpnumwidth{25pt}}
\addtocontents{lof}{\protect\renewcommand{\protect\cftdot}{}}

\phantomsection
\addtocontents{lof}{
  \protect\contentsline{figure}{
    \hspace{-0.1cm}\begin{minipage}[t]{\textwidth}
      \centering
      \textbf{\underline{\figurename}}
      \hfill
      \textbf{\underline{Page}}
    \end{minipage}
}{}{}} 

\phantomsection\addtocontents{lof}{\vspace{-1.1cm}}

\addtocontents{lof}{\protect\renewcommand{\protect\cftdot}{\origcftdot}}

\renewcommand{\cfttabaftersnum}{.}
\renewcommand{\cftfigaftersnum}{.}

\makeatother

% Remove the colon in the captions of the figures and tables
\usepackage{caption}
\DeclareCaptionLabelSeparator{dotspace}{.\hspace*{0.5em}}
\captionsetup[table]{labelsep=dotspace}
\captionsetup[figure]{labelsep=dotspace}

% Figure caption & spacings
\captionsetup{format=hang}
\captionsetup{font={stretch=1.5}}
\setlength{\floatsep}{0.5cm} % Space between floats
\BeforeBeginEnvironment{table}{\vspace{0.5cm}} % Before table
\AfterEndEnvironment{table}{\vspace{0.5cm}}   % After table
\BeforeBeginEnvironment{figure}{\vspace{0.5cm}}

\raggedbottom
\allowdisplaybreaks

% Set up chapter-based numbering for figures and tables
\usepackage{chngcntr}
\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}
\counterwithin{equation}{chapter}

% Customizing the labels in captions
\renewcommand{\thefigure}{\thechapter.\arabic{figure}}
\renewcommand{\thetable}{\thechapter.\arabic{table}}
\renewcommand{\theequation}{\thechapter.\arabic{equation}}

% Eliminate the footskip warning
\setlength{\footskip}{14.49998pt}

